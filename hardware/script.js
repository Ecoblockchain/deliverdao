var Web3 = require('web3');
var PythonShell = require('python-shell');

if(typeof web3 === 'undefined')
    web3 = new Web3(new Web3.providers.HttpProvider("http://10.60.36.8:8545"));

PythonShell.run('./read.py', function (err, data) {
  if (err) throw err;

  var deliverdaoContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"proposals","outputs":[{"name":"name","type":"bytes32"},{"name":"description","type":"string"},{"name":"creator","type":"address"},{"name":"requestedAmount","type":"uint256"},{"name":"weightedVote","type":"uint256"},{"name":"threshold","type":"uint256"},{"name":"active","type":"bool"},{"name":"successful","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"},{"name":"_value","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"makeOrder","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"bytes32"},{"name":"_address","type":"address"}],"name":"addCourier","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"takeOrder","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"shippers","outputs":[{"name":"name","type":"bytes32"},{"name":"totalSent","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[{"name":"_name","type":"bytes32"},{"name":"_description","type":"string"},{"name":"_requestedAmount","type":"uint256"}],"name":"createProposal","outputs":[{"name":"proposal","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"bytes32"},{"name":"_address","type":"address"}],"name":"addShipper","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"voteProposal","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"deliveries","outputs":[{"name":"courier","type":"address"},{"name":"shipper","type":"address"},{"name":"totalValue","type":"uint256"},{"name":"fee","type":"uint256"},{"name":"active","type":"bool"},{"name":"beingShipped","type":"bool"},{"name":"arrived","type":"bool"},{"name":"deposit","type":"uint256"},{"name":"deadline","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"requiredDeposit","outputs":[{"name":"depositAmount","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"deadline","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"couriers","outputs":[{"name":"name","type":"bytes32"},{"name":"reputation","type":"uint256"},{"name":"totalDelivered","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"courierAddr","type":"address"},{"name":"rating","type":"uint256"}],"name":"leaveRating","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"arrived","outputs":[],"type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"}],"name":"newOrder","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"},{"indexed":false,"name":"courier","type":"address"}],"name":"orderFulfilled","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"orderArrived","type":"event"}]);

  var contract = deliverdaoContract.at(data);

  deliverdao.arrived(1, {from: web3.eth.accounts[1], value: success, gas: 600000})
});
